<script>
 function showChilds(parent, num_children, is_auth, depth) {
     console.log("showChilds "+parent);
     if ($("#showreplies-"+parent).length) {
         $("#showreplies-"+parent).html("Piilota vastaukset ("+num_children+")");
         $("#showreplies-"+parent).attr("onclick", "hideChilds("+parent+", "+num_children+", "+is_auth+", "+depth+"); return false;");
     }
     $.getJSON("/getposts?parent="+parent, function(result){
         $.each(result, function(i, post) {
             posthtml = "<div class='post' id='post-"+post['id']+"'><p class='post-user'>"+post['username']+"</p><p class='post-message'>"+post['message']+"</p><div class='replybar'>";
             if (is_auth) {
                 posthtml += "<a href='' onclick='showReplyField("+post['id']+");return false;'>Vastaa</a>";
             }
             if (post['children'] > 0) {
                 posthtml += "<a style='margin-left:15px;' id='showreplies-"+post['id']+"' href='' onclick='showChilds("+post['id']+", "+post['children']+", "+is_auth+", "+(depth+1)+");return false;'>N채yt채 vastaukset ("+post['children']+")";
             }
             posthtml += "</div><div id='post-"+post['id']+"-children' class='post-children'></div></div>";
             $("#post-"+parent+"-children").append(posthtml);
         });
         if (depth == 0) {
             $.each(result, function(i, post) {
                 showChilds(post['id'], post['children'], is_auth, depth+1);
             });
         }
     });
 }

 function hideChilds(parent, num_children, is_auth, depth) {
     console.log("hideChilds "+parent);
     $("#post-"+parent+"-children").empty();
     $("#showreplies-"+parent).html("N채yt채 vastaukset ("+num_children+")");
     $("#showreplies-"+parent).attr("onclick", "showChilds("+parent+", "+num_children+", "+is_auth+", "+depth+"); return false;");
 }

 function showReplyField(post) {
     $("#post-"+post+"-replyfield").remove();
     replyhtml = '<div class="replyfield" id="post-'+post+'-replyfield"><form method="POST" action=" {{ url_for('posts_create') }} "> {{ postform.message }} <input type="hidden" name="parent_msg" value="'+post+'"/><br><input type="submit" value="Reply"/></form></div>';
     $("#post-"+post+"-children").prepend(replyhtml);
 }
</script>
